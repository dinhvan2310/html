import{M as O,r,j as n,a as e,s as y,c as T,u as H,q as Q,F as E,t as M,v as A,R as X,l as j,d as z,S as J}from"./index-30947b0f.js";import{u as K}from"./useMutation-0d6a1b83.js";import"./Spinner-40cba6e3.js";import{M as W}from"./ModalNotice-e76ca594.js";O.setAppElement("#root");const Z=({lng:a,itemModal:t,buy:_,modalStatus:i,closeModal:h})=>{const[m,S]=r.useState(""),[N,u]=r.useState(""),[p,b]=r.useState(""),g=()=>{},f=o=>{o.preventDefault(),h()};r.useRef();const d=o=>{if(o.preventDefault(),p)return!1;if(!m)return u("Bạn hãy nhập vào UID người bạn muốn tặng"),!1;y(`Sử dụng ${t==null?void 0:t.price} <img src="/images/gem.png" alt="" class="icon-gem icon-gem--small" /> để tặng cho ${m}<br><br><div class="item-cover"><img src="${t==null?void 0:t.item_img}" alt="" /></div><p>${t==null?void 0:t.item_name}</p>`,a==null?void 0:a.cancel).then(q=>{q.value&&(b(!0),_({params:{id:parseInt(t==null?void 0:t.id),to_account_id:parseInt(m)}}).then(I=>{var w;b(!1),(I==null?void 0:I.status)==((w=T)==null?void 0:w.statusSuccess)&&y(`Bạn đã tặng thành công<br><br><div class="item-cover"><img src="${t==null?void 0:t.item_img}" alt="" /></div><p>${t==null?void 0:t.item_name}</p><small class="text-transform-normal">*Vật phẩm sẽ được gửi vào hòm đồ của người bạn tặng</small>`).then(()=>{H("userData","can_gift_on_exclusive_store",!1),Q.invalidateQueries({queryKey:["gemBalance"]}),h()})}))})};return n(O,{isOpen:i,onAfterOpen:g,onRequestClose:f,contentLabel:"Example Modal",portalClassName:"ReactModalPortal",overlayClassName:"",className:"swing-in-top-fwd modal-rule",children:[e("h2",{children:"Tặng quà cho bạn"}),e("div",{className:"modal-description",children:e("div",{className:"row justify-content-center",children:n("div",{className:"col-6",children:[e("div",{className:"rank-img rank-img--big",children:e("img",{src:t==null?void 0:t.item_img,alt:""})}),n("p",{className:"text-center",children:[t==null?void 0:t.item_name,"."]}),n("form",{action:"",onSubmit:o=>d(o),children:[e("div",{className:"input-control",children:e("input",{type:"text",value:m,placeholder:a==null?void 0:a.your_friend_id,onChange:o=>{S(o.target.value),u("")}})}),N&&e("p",{className:"text-danger text-center",children:N}),e("div",{className:"text-center",children:e("button",{className:"btn btn--submit",type:"submit",children:a==null?void 0:a.btn_send})})]})]})})}),e("a",{onClick:o=>f(o),className:"close","data-dismiss":"modal","aria-label":"Close",children:"×"})]})};O.setAppElement("#root");const ee=({lng:a,itemModal:t,buy:_,count_invited:i,membership_type:h,modalStatus:m,closeModal:S})=>{const[N]=K("/user/invite_to_exclusive_store"),[u,p]=r.useState(""),[b,g]=r.useState(""),[f,d]=r.useState(""),[o,q]=r.useState(""),[I,w]=r.useState(""),[U,G]=r.useState(""),Y=()=>{},R=l=>{l.preventDefault(),S()};r.useRef();const $=l=>{if(l.preventDefault(),U)return!1;if(i)return d("Bạn đã hết lượt tặng rồi"),!1;if(!u)return d("Bạn hãy nhập vào UID người bạn muốn tặng"),!1;G(!0),N({params:{id:parseInt(u),message:o}}).then(x=>{var C;G(!1),(x==null?void 0:x.status)==((C=T)==null?void 0:C.statusSuccess)&&y("Gửi lời mời thành công").then(()=>{H("userData","count_invited",i+1),H("userData","can_invite_to_exclusive_store",!1),S()})})},P=l=>{l.preventDefault();let x=0;if(!u)return d("Bạn hãy nhập ít nhất một UID bạn của mình"),!1;if(U)return!1;if(u&&x++,b&&x++,x>2-i)return d("Bạn không có đủ lượt mời"),!1;G(!0),N({params:{id:parseInt(u),message:o}}).then(C=>{var k;G(!1),(C==null?void 0:C.status)==((k=T)==null?void 0:k.statusSuccess)&&(b?sendGift({params:{id:parseInt(b),message:I}}).then(v=>{var B;(v==null?void 0:v.status)==((B=T)==null?void 0:B.statusSuccess)&&y("Gửi lời mời thành công").then(()=>{H("userData","count_invited",i+2),H("userData","can_invite_to_exclusive_store",!1),S()})}):y("Gửi lời mời thành công").then(()=>{H("userData","count_invited",i+1),H("userData","can_invite_to_exclusive_store",i+1<2),S()}))})};return n(O,{isOpen:m,onAfterOpen:Y,onRequestClose:R,contentLabel:"Example Modal",portalClassName:"ReactModalPortal",overlayClassName:"",className:"swing-in-top-fwd modal-rule",children:[e("h2",{children:"Mời bạn vào cửa hàng độc quyền"}),n("div",{className:"modal-description",children:[h=="DIAMOND"&&n("div",{className:"row",children:[n("div",{className:"col-5",children:[e("div",{className:"rank-img rank-img--big",children:e("img",{src:"/images/star-big.png",alt:""})}),i<1&&n("p",{className:"text-center",children:["Bạn có thể mời 1 người truy cập ",e("br",{}),"Cửa Hàng Độc Quyền trong hôm nay"]})]}),e("div",{className:"col-7",children:n("form",{action:"",onSubmit:l=>$(l),children:[e("div",{className:"input-control",children:e("input",{value:u,type:"text",placeholder:a==null?void 0:a.your_friend_id,onChange:l=>{p(l.target.value),d("")}})}),n("div",{className:"input-control",children:[e("textarea",{value:o,onChange:l=>q(l.target.value),name:"",id:"",placeholder:a==null?void 0:a.message}),f&&e("p",{className:"text-danger text-center",children:f})]}),e("div",{className:"text-center",children:e("button",{className:"btn btn--submit",type:"submit",children:a==null?void 0:a.btn_send})})]})})]}),h=="LEGENDARY"&&n(E,{children:[e("p",{className:"text-center",children:2-i>0&&n(E,{children:["Bạn có thể mời ",2-i," người",e("br",{}),"truy cập Cửa Hàng Độc Quyền trong hôm nay"]})}),e("div",{className:"container",children:n("form",{action:"",className:"row",onSubmit:l=>P(l),children:[e("div",{className:"col-4",children:e("div",{className:"rank-img rank-img--big",children:e("img",{src:"/images/star-big.png",alt:""})})}),e("div",{className:"col-4",children:n("div",{children:[e("div",{className:"input-control",children:e("input",{type:"text",value:u,onChange:l=>{p(l.target.value),d("")},placeholder:"UID thứ nhất (Bắt buộc)"})}),e("div",{className:"input-control input-control--small",children:e("textarea",{name:"",id:"",placeholder:a==null?void 0:a.message})})]})}),e("div",{className:"col-4",children:n("div",{children:[e("div",{className:"input-control",children:e("input",{type:"text",value:b,onChange:l=>{g(l.target.value)},placeholder:"UID người thứ 2"})}),e("div",{className:"input-control input-control--small",children:e("textarea",{name:"",value:I,onChange:l=>w(l.target.value),id:"",placeholder:a==null?void 0:a.message})})]})}),n("div",{className:"col-12",children:[f&&e("p",{className:"text-danger text-center",children:f}),e("br",{}),e("div",{className:"text-center",children:e("button",{className:"btn btn--submit",type:"submit",children:a==null?void 0:a.btn_send})})]})]})})]})]}),e("a",{onClick:l=>R(l),className:"close","data-dismiss":"modal","aria-label":"Close",children:"×"})]})},ae=(a,t)=>{const _=r.useRef();r.useEffect(()=>{_.current=a},[a]),r.useEffect(()=>{function i(){_.current()}if(t!==null){let h=setInterval(i,t);return()=>clearInterval(h)}},[t])},se=({delta:a,endTime:t,callback:_=null})=>{const[i,h]=r.useState(""),[m,S]=r.useState(""),[N,u]=r.useState(""),[p,b]=r.useState("");let g,f=new Date(M(t)).getTime(),d=typeof i=="number"&&typeof m=="number"&&typeof N=="number"&&typeof p=="number"&&i<=0&&m<=0&&N<=0&&p<=0&&f-new Date().getTime()+a<=0;return ae(()=>{let o=new Date().getTime()+a;g=f-o,h(Math.floor(g/(1e3*60*60*24))),S(Math.floor(g%(1e3*60*60*24)/(1e3*60*60))),u(Math.floor(g%(1e3*60*60)/(1e3*60))),b(Math.floor(g%(1e3*60)/1e3))},d?null:1e3),r.useEffect(()=>{d&&_&&_()},[d,_]),n(E,{children:[i>0&&n(E,{children:[A(Math.max(0,i))," Ngày"]})," ",A(Math.max(0,m)),":",A(Math.max(0,N)),":",A(Math.max(0,p))]})},le=({lng:a,user:{player:{id:t=null,account_id:_=null,nick_name:i=""}={},can_access_to_exclusive_store:h=!1,can_invite_to_exclusive_store:m=!1,can_gift_on_exclusive_store:S=!1,can_buy_on_exclusive_store:N=!1,access_to_exclusive_store_end_time:u=null,membership:p=null,count_invited:b=0}={},event:{exclusive_store_items:g=[]}={},delta:f})=>{const[d]=K("/user/buy_exclusive_item"),[o,q]=r.useState(!1),I=()=>q(!1),[w,U]=r.useState(!1),G=()=>U(!1),[Y,R]=r.useState(!1),$=()=>R(!1),[P,l]=r.useState(null),[x,C]=r.useState(!1),k=p==null?void 0:p.membership_type,v=[...g].sort((s,c)=>s.order-c.order),B=(s,c,D)=>{if(D.preventDefault(),!t)return j(),!1;if(x)return!1;if(k!="DIAMOND"&&k!="LEGENDARY"&&!h)return q(!0),!1;if(!h)return y("BẠN CHỈ CÓ THỂ TRUY CẬP CỬA HÀNG ĐỘC QUYỀN VÀO NGÀY LÊN HẠNG HOẶC GIỮ HẠNG KIM CƯƠNG/HUYỀN THOẠI NHÉ"),!1;if(s=="gift"&&k!="LEGENDARY")return y("Bạn cần phải đạt hạng HUYỀN THOẠI để có thể tặng cho bạn của mình"),!1;if(!S&&k=="LEGENDARY")return y("Bạn đã sử dụng quyền tặng hoặc mua trước đó rồi"),!1;if(!N)return y("Bạn đã sử dụng quyền tặng hoặc mua trước đó rồi"),!1;if(s=="gift")return l(c),U(!0),!1;y(`Sử dụng ${c==null?void 0:c.price} <img src="/images/gem.png" alt="" class="icon-gem icon-gem--small" /> để mua<br><br><div class="item-cover"><img src="${c==null?void 0:c.item_img}" alt="" /></div><p>${c==null?void 0:c.item_name}</p>`,a==null?void 0:a.cancel).then(V=>{V.value&&(C(!0),d({params:{id:parseInt(c==null?void 0:c.id)}}).then(L=>{var F;C(!1),(L==null?void 0:L.status)==((F=T)==null?void 0:F.statusSuccess)&&y(`Bạn nhận được<br><br><div class="item-cover"><img src="${c==null?void 0:c.item_img}" alt="" /></div><p>${c==null?void 0:c.item_name}</p><small class="text-transform-normal">*Vật phẩm sẽ được gửi vào hòm đồ của bạn</small>`).then(()=>{H("userData","can_buy_on_exclusive_store",!1),Q.invalidateQueries({queryKey:["gemBalance"]})})}))})};return n(E,{children:[n("div",{className:"main-content main-featured",children:[e("span",{className:"btn btn--shop",children:"Cửa hàng độc quyền"}),e("div",{className:"main",children:e("div",{className:"shop-list",children:e("div",{className:"container",children:n("div",{className:"row",children:[e("div",{className:"col col--shop-special",children:(v==null?void 0:v.length)>0&&v.map((s,c)=>c<2&&n(X.Fragment,{children:[n("div",{className:"shop-cover shop-cover--special",children:[n("div",{className:"shop-cover__img",children:[e("img",{src:s==null?void 0:s.item_img,alt:""}),(s==null?void 0:s.item_quantity)>1&&n("span",{className:"item-quantity",children:["x",s==null?void 0:s.item_quantity]})]}),(s==null?void 0:s.is_exclusive)&&e("div",{className:"tag",children:e("span",{children:a==null?void 0:a.exclusive})}),n("div",{className:"shop-cover__pricing",children:[n("span",{className:"text-gradient",children:[s==null?void 0:s.price," ",e("em",{children:s==null?void 0:s.price})]})," ",e("img",{src:"/images/gem.png",alt:"",className:"icon-gem icon-gem--medium"})]}),e("div",{className:"shop-cover__name",children:s==null?void 0:s.item_name})]}),n("div",{className:"text-center",children:[e("a",{href:"#",onClick:D=>B("buy",s,D),className:"btn btn--buy btn--buy--big",children:a==null?void 0:a.btn_buy}),e("a",{href:"#",onClick:D=>B("gift",s,D),className:"btn btn--buy btn--buy--big",children:a==null?void 0:a.btn_gift})]}),c==0&&e("div",{className:"special-separate"})]},c))}),n("div",{className:"col col--shop-normal",children:[e("a",{href:"#",className:"btn btn-invite",onClick:s=>{if(s.preventDefault(),!t)return j(),!1;if(!m)return q(!0),!1;R(!0)},children:"Mời bạn truy cập"}),e("div",{className:`lock-exc${h?" lock-exc--unlocked":""}`,children:e("div",{className:"lock-exc__content",children:h?e(E,{children:e("div",{className:"container",children:n("div",{className:"row align-items-center",children:[e("div",{className:"col-4",children:"ĐÓNG SAU:"}),n("div",{className:"col-8",children:[e("span",{className:"count-time",children:u&&e(se,{delta:f,endTime:z(u*1e3).format("YYYY-MM-DD HH:mm:ss")})}),e("p",{children:"Số món có thể mua/tặng: 01"})]})]})})}):n(E,{children:["Cửa Hàng sẽ mở vào ngày thăng hạng",e("br",{}),"hoặc giữ hạng Kim Cương hoặc Huyền Thoại"]})})}),e(J,{style:{height:"45vh"},className:"shop-scrollbar",noScrollX:!0,children:e("div",{className:"row",children:(v==null?void 0:v.length)>0&&v.map((s,c)=>c>=2&&n("div",{className:"col-4",children:[n("div",{className:"shop-cover",children:[n("div",{className:"shop-cover__img",children:[e("img",{src:s==null?void 0:s.item_img,alt:""}),(s==null?void 0:s.item_quantity)>1&&n("span",{className:"item-quantity",children:["x",s==null?void 0:s.item_quantity]})]}),n("div",{className:"shop-cover__pricing",children:[n("span",{className:"text-gradient",children:[s==null?void 0:s.price," ",e("em",{children:s==null?void 0:s.price})]})," ",e("img",{src:"/images/gem.png",alt:"",className:"icon-gem icon-gem--small"})]}),e("div",{className:"shop-cover__name",children:s==null?void 0:s.item_name})]}),n("div",{className:"text-center",children:[e("a",{href:"#",onClick:D=>B("buy",s,D),className:"btn btn--buy",children:a==null?void 0:a.btn_buy}),e("a",{href:"#",onClick:D=>B("gift",s,D),className:"btn btn--buy",children:a==null?void 0:a.btn_gift})]})]},c))})})]})]})})})})]}),o&&e(W,{lng:a,type:2,modalStatus:o,closeModal:I}),Y&&e(ee,{lng:a,count_invited:b,membership_type:k,modalStatus:Y,closeModal:$}),w&&e(Z,{lng:a,buy:d,itemModal:P,modalStatus:w,closeModal:G})]})};export{le as default};

var E=Object.defineProperty,P=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var S=(c,l,r)=>l in c?E(c,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[l]=r,q=(c,l)=>{for(var r in l||(l={}))V.call(l,r)&&S(c,r,l[r]);if(x)for(var r of x(l))X.call(l,r)&&S(c,r,l[r]);return c},M=(c,l)=>P(c,L(l));import{r as w,j as n,F as z,a as s,R as A,S as G,l as H,s as v,c as J,n as K,u as C}from"./index-30947b0f.js";import{u as O}from"./useMutation-0d6a1b83.js";import"./Spinner-40cba6e3.js";import{M as Q}from"./ModalNotice-e76ca594.js";const m=({lng:c,user:{player:{id:l=null,account_id:r=null,nick_name:T=""}={},available_converted_score:$=0,membership:g=null}={},event:{exchange_store_items:D=[]}={}})=>{const[j]=O("/user/exchange_item"),[u,_]=w.useState(!1),k=()=>_(!1),[B,N]=w.useState(!1),F=g==null?void 0:g.membership_type,e=[...D].sort((a,o)=>a.order-o.order),t=(a,o)=>{if(o.preventDefault(),!l)return H(),!1;if(B)return!1;if(F||_(!0),$<(a==null?void 0:a.price))return v('Bạn chưa đủ <img src="/images/icon-point.png" alt="" class="icon-gem icon-gem--small" /> để quy đổi vật phẩm này'),!1;if((a==null?void 0:a.exchanged)>=(a==null?void 0:a.limit))return v("Bạn đã đạt giới hạn quy đổi vật phẩm này"),!1;v(`Sử dụng ${a==null?void 0:a.price} <img src="/images/icon-point.png" alt="" class="icon-gem icon-gem--small" /> để quy đổi <br><br><div class="item-cover"><img src="${a==null?void 0:a.item_img}" alt="" /></div><p>${a==null?void 0:a.item_name}</p>`,c==null?void 0:c.cancel).then(p=>{p.value&&(N(!0),j({params:{id:parseInt(a==null?void 0:a.id)}}).then(d=>{var f;N(!1),(d==null?void 0:d.status)==((f=J)==null?void 0:f.statusSuccess)&&v(`Bạn nhận được<br><br><div class="item-cover"><img src="${a==null?void 0:a.item_img}" alt="" /></div><p>${a==null?void 0:a.item_name}</p><small class="text-transform-normal">*Vật phẩm sẽ được gửi vào hòm đồ của bạn</small>`).then(()=>{var y,b;let i=K("eventData"),R=(y=i==null?void 0:i.payload)==null?void 0:y.exchange_store_items.map(h=>(h==null?void 0:h.id)==(a==null?void 0:a.id)?M(q({},h),{exchanged:(h==null?void 0:h.exchanged)+1}):h);C("eventData","exchange_store_items",R),C("userData","available_converted_score",(b=d==null?void 0:d.payload)==null?void 0:b.available_converted_score)})}))})};return n(z,{children:[n("div",{className:"main-content main-shop",children:[s("span",{className:"btn btn--shop",children:"Cửa hàng quy đổi"}),s("div",{className:"main",children:s("div",{className:"shop-list",children:s("div",{className:"container",children:n("div",{className:"row",children:[s("div",{className:"col col--shop-special",children:(e==null?void 0:e.length)>0&&e.map((a,o)=>o<2&&n(A.Fragment,{children:[n("div",{className:"shop-cover shop-cover--special",children:[n("div",{className:"shop-cover__img",children:[s("img",{src:a==null?void 0:a.item_img,alt:""}),(a==null?void 0:a.item_quantity)>1&&n("span",{className:"item-quantity",children:["x",a==null?void 0:a.item_quantity]}),n("span",{className:"item-limit",children:[a==null?void 0:a.exchanged,"/",a==null?void 0:a.limit]})]}),n("div",{className:"shop-cover__pricing",children:[n("span",{className:"text-gradient",children:[a==null?void 0:a.price," ",s("em",{children:a==null?void 0:a.price})]})," ",s("img",{src:"/images/icon-point.png",alt:"",className:"icon-gem icon-gem--medium"})]}),s("div",{className:"shop-cover__name",children:a==null?void 0:a.item_name})]}),s("div",{className:"text-start shop-actions",children:s("a",{href:"#",onClick:p=>t(a,p),className:"btn btn--buy btn--buy--big",children:c==null?void 0:c.btn_exchange})}),o==0&&s("div",{className:"special-separate"})]},o))}),s("div",{className:"col col--shop-normal",children:s(G,{style:{height:"45vh"},className:"shop-scrollbar",noScrollX:!0,children:s("div",{className:"row",children:(e==null?void 0:e.length)>0&&e.map((a,o)=>o>=2&&n("div",{className:"col-4",children:[n("div",{className:"shop-cover",children:[n("div",{className:"shop-cover__img",children:[s("img",{src:a==null?void 0:a.item_img,alt:""}),(a==null?void 0:a.item_quantity)>1&&n("span",{className:"item-quantity",children:["x",a==null?void 0:a.item_quantity]}),n("span",{className:"item-limit",children:[a==null?void 0:a.exchanged,"/",a==null?void 0:a.limit]})]}),n("div",{className:"shop-cover__pricing",children:[n("span",{className:"text-gradient",children:[a==null?void 0:a.price," ",s("em",{children:a==null?void 0:a.price})]})," ",s("img",{src:"/images/icon-point.png",alt:"",className:"icon-gem icon-gem--small"})]}),s("div",{className:"shop-cover__name",children:a==null?void 0:a.item_name})]}),s("div",{className:"text-start shop-actions",children:s("a",{href:"#",onClick:p=>t(a,p),className:"btn btn--buy",children:c==null?void 0:c.btn_exchange})})]},o))})})})]})})})})]}),u&&s(Q,{lng:c,type:1,modalStatus:u,closeModal:k})]})};export{m as default};
